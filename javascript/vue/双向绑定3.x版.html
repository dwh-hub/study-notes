<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>双向绑定2&amp;3差异 | 大花园</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/study-notes/assets/css/0.styles.12dc5de2.css" as="style"><link rel="preload" href="/study-notes/assets/js/app.7e1e994a.js" as="script"><link rel="preload" href="/study-notes/assets/js/2.0746be48.js" as="script"><link rel="preload" href="/study-notes/assets/js/25.b6bb2340.js" as="script"><link rel="prefetch" href="/study-notes/assets/js/10.8a4da6bb.js"><link rel="prefetch" href="/study-notes/assets/js/11.20ce6380.js"><link rel="prefetch" href="/study-notes/assets/js/12.8b312a49.js"><link rel="prefetch" href="/study-notes/assets/js/13.b98ff32f.js"><link rel="prefetch" href="/study-notes/assets/js/14.38f8fdad.js"><link rel="prefetch" href="/study-notes/assets/js/15.d54587e2.js"><link rel="prefetch" href="/study-notes/assets/js/16.4bd65ae5.js"><link rel="prefetch" href="/study-notes/assets/js/17.7988cdff.js"><link rel="prefetch" href="/study-notes/assets/js/18.8ece47cb.js"><link rel="prefetch" href="/study-notes/assets/js/19.6021ea64.js"><link rel="prefetch" href="/study-notes/assets/js/20.eb326891.js"><link rel="prefetch" href="/study-notes/assets/js/21.65ecae84.js"><link rel="prefetch" href="/study-notes/assets/js/22.4e18d6d0.js"><link rel="prefetch" href="/study-notes/assets/js/23.1d95239a.js"><link rel="prefetch" href="/study-notes/assets/js/24.cf465ba5.js"><link rel="prefetch" href="/study-notes/assets/js/26.cb8feba7.js"><link rel="prefetch" href="/study-notes/assets/js/27.d0797b76.js"><link rel="prefetch" href="/study-notes/assets/js/28.45fcbdd5.js"><link rel="prefetch" href="/study-notes/assets/js/29.b17fc289.js"><link rel="prefetch" href="/study-notes/assets/js/3.6d09d08b.js"><link rel="prefetch" href="/study-notes/assets/js/30.01734cff.js"><link rel="prefetch" href="/study-notes/assets/js/31.73036dab.js"><link rel="prefetch" href="/study-notes/assets/js/32.dd5cc511.js"><link rel="prefetch" href="/study-notes/assets/js/33.3e725de2.js"><link rel="prefetch" href="/study-notes/assets/js/34.189e2e07.js"><link rel="prefetch" href="/study-notes/assets/js/35.abb889d5.js"><link rel="prefetch" href="/study-notes/assets/js/36.9f18fd78.js"><link rel="prefetch" href="/study-notes/assets/js/37.4a311e88.js"><link rel="prefetch" href="/study-notes/assets/js/38.5d51d7d1.js"><link rel="prefetch" href="/study-notes/assets/js/39.5c40535e.js"><link rel="prefetch" href="/study-notes/assets/js/4.e0b637aa.js"><link rel="prefetch" href="/study-notes/assets/js/40.19b37fb0.js"><link rel="prefetch" href="/study-notes/assets/js/41.14d7262b.js"><link rel="prefetch" href="/study-notes/assets/js/42.97a838c4.js"><link rel="prefetch" href="/study-notes/assets/js/43.cea03d38.js"><link rel="prefetch" href="/study-notes/assets/js/5.2e4024d9.js"><link rel="prefetch" href="/study-notes/assets/js/6.40df3bc6.js"><link rel="prefetch" href="/study-notes/assets/js/7.7e7e647a.js"><link rel="prefetch" href="/study-notes/assets/js/8.ac5c895f.js"><link rel="prefetch" href="/study-notes/assets/js/9.966f7879.js">
    <link rel="stylesheet" href="/study-notes/assets/css/0.styles.12dc5de2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/study-notes/" class="home-link router-link-active"><!----> <span class="site-name">大花园</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="web2" class="dropdown-title"><span class="title">web2</span> <span class="arrow down"></span></button> <button type="button" aria-label="web2" class="mobile-dropdown-title"><span class="title">web2</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/study-notes/javascript/" class="nav-link router-link-active">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/study-notes/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/study-notes/engineering/" class="nav-link">
  工程化
</a></li></ul></div></div><div class="nav-item"><a href="/study-notes/design-pattern/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="web3学习" class="dropdown-title"><span class="title">web3学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="web3学习" class="mobile-dropdown-title"><span class="title">web3学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/study-notes/web3/solidity/" class="nav-link">
  solidity
</a></li><li class="dropdown-item"><!----> <a href="/study-notes/web3/web3js/" class="nav-link">
  web3js
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="web2" class="dropdown-title"><span class="title">web2</span> <span class="arrow down"></span></button> <button type="button" aria-label="web2" class="mobile-dropdown-title"><span class="title">web2</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/study-notes/javascript/" class="nav-link router-link-active">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/study-notes/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/study-notes/engineering/" class="nav-link">
  工程化
</a></li></ul></div></div><div class="nav-item"><a href="/study-notes/design-pattern/" class="nav-link">
  设计模式
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="web3学习" class="dropdown-title"><span class="title">web3学习</span> <span class="arrow down"></span></button> <button type="button" aria-label="web3学习" class="mobile-dropdown-title"><span class="title">web3学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/study-notes/web3/solidity/" class="nav-link">
  solidity
</a></li><li class="dropdown-item"><!----> <a href="/study-notes/web3/web3js/" class="nav-link">
  web3js
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>html&amp;浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>vue</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study-notes/javascript/vue/基础知识.html" class="sidebar-link">基础知识</a></li><li><a href="/study-notes/javascript/vue/双向绑定2.x版.html" class="sidebar-link">双向绑定2.x版</a></li><li><a href="/study-notes/javascript/vue/双向绑定3.x版.html" class="active sidebar-link">双向绑定2&amp;3差异</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study-notes/javascript/vue/双向绑定3.x版.html#vue2-x" class="sidebar-link">Vue2.x</a></li><li class="sidebar-sub-header"><a href="/study-notes/javascript/vue/双向绑定3.x版.html#vue3-x" class="sidebar-link">Vue3.x</a></li><li class="sidebar-sub-header"><a href="/study-notes/javascript/vue/双向绑定3.x版.html#object-defineproperty" class="sidebar-link">Object.defineProperty</a></li><li class="sidebar-sub-header"><a href="/study-notes/javascript/vue/双向绑定3.x版.html#proxy" class="sidebar-link">Proxy</a></li></ul></li><li><a href="/study-notes/javascript/vue/模板编译.html" class="sidebar-link">模板编译</a></li><li><a href="/study-notes/javascript/vue/原理浅析.html" class="sidebar-link">原理浅析</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="双向绑定2-3差异"><a href="#双向绑定2-3差异" class="header-anchor">#</a> 双向绑定2&amp;3差异</h1> <p>这篇笔记主要讲下2.x和3.x双向绑定上的差异</p> <h2 id="vue2-x"><a href="#vue2-x" class="header-anchor">#</a> Vue2.x</h2> <h3 id="_1-object-defineproperty"><a href="#_1-object-defineproperty" class="header-anchor">#</a> 1. Object.defineProperty()</h3> <p><strong>数据劫持的方法</strong></p> <p>Object.defineProperty() 是 es5 的属性，其通过 get() 和 set() 方法劫持数据的读写。</p> <h3 id="_2-对-data-数据进行遍历"><a href="#_2-对-data-数据进行遍历" class="header-anchor">#</a> 2. 对 data 数据进行遍历</h3> <p><strong>将data内的所有数据转为能被监听的数据</strong></p> <p>每个组件都有一个 data 选项，当组件渲染过程中，会对 data 数据进行遍历，用 Object.defineProperty 转为 getter/setter。</p> <ol><li>data 数据中存在对象，进行遍历递归</li> <li>data 数据中有数组，如果数组元素为对象，重复1。没有则进行特殊处理</li></ol> <h3 id="_3-针对数组需要额外处理"><a href="#_3-针对数组需要额外处理" class="header-anchor">#</a> 3. 针对数组需要额外处理</h3> <p><strong>缺陷：Object.defineProperty() 不能实现直接对数组的监听</strong></p> <p>Vue2.x 不能检测两种改变</p> <ol><li>利用索引直接改变，es6改变时数组实例的方法</li> <li>修改数组长度</li></ol> <p>对应的解决方法</p> <ol><li><code>Vue.Set(this.arr, index, newValue)</code> 或者 深拷贝新的值覆盖</li> <li><code>this.arr.splice(newLength)</code></li></ol> <p><strong>Vue能对数组进行监听的原因是，把数组的方法重写了。总结起来就是这几步：</strong></p> <ol><li>先获取原生 Array 的原型方法，因为拦截后还是需要原生的方法帮我们实现数组的变化</li> <li>对 Array 的原型方法使用 Object.defineProperty 做一些拦截操作</li> <li>把需要被拦截的 Array 类型的数据原型指向改造后原型</li></ol> <h2 id="vue3-x"><a href="#vue3-x" class="header-anchor">#</a> Vue3.x</h2> <h3 id="_1-proxy"><a href="#_1-proxy" class="header-anchor">#</a> 1. Proxy()</h3> <p><strong>数据劫持的方法</strong></p> <h3 id="_2-ref-reactive"><a href="#_2-ref-reactive" class="header-anchor">#</a> 2. ref() reactive()</h3> <p><strong>需要监听的数据使用特殊方法标明</strong></p> <h3 id="_3-不需要对数组进行额外处理"><a href="#_3-不需要对数组进行额外处理" class="header-anchor">#</a> 3. 不需要对数组进行额外处理</h3> <p><strong>Proxy() 可以实现对数组的监听</strong></p> <h2 id="object-defineproperty"><a href="#object-defineproperty" class="header-anchor">#</a> Object.defineProperty</h2> <p>用于直接在一个对象上定义一个新属性，或者修改一个对象的现有属性，并返回此对象
普通的给对象添加属性</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> game <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
game<span class="token punctuation">.</span>price <span class="token operator">=</span> <span class="token number">298</span>
</code></pre></div><p><code>Object.defineProperty()</code>版</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> game <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// 1. 正常添加</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>game<span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">value</span><span class="token operator">:</span> <span class="token number">298</span><span class="token punctuation">,</span>
  <span class="token literal-property property">writable</span><span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
game<span class="token punctuation">.</span>price <span class="token comment">// 298</span>

<span class="token comment">// 2. 数据监听写法</span>
<span class="token comment">// 注：如果设置了 set 或 get, 就不能设置 writable 和 value 中的任何一个</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>game<span class="token punctuation">,</span> <span class="token string">'price'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token number">298</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'新属性值'</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
game<span class="token punctuation">.</span>price <span class="token comment">// 298</span>
</code></pre></div><h2 id="proxy"><a href="#proxy" class="header-anchor">#</a> Proxy</h2> <p>Proxy 对象用于创建一个对象的代理，从而实现基本操作的拦截和自定义（如属性查找、赋值、枚举、函数调用等），具体参考<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Proxy" target="_blank" rel="noopener noreferrer">MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>基础示例</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> handler <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token function-variable function">get</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> prop <span class="token keyword">in</span> obj <span class="token operator">?</span> obj<span class="token punctuation">[</span>prop<span class="token punctuation">]</span> <span class="token operator">:</span> <span class="token number">37</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">set</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">obj<span class="token punctuation">,</span> prop<span class="token punctuation">,</span> value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>prop<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">属性修改后的值：</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> handler<span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token keyword">undefined</span><span class="token punctuation">;</span>

p<span class="token punctuation">.</span>a <span class="token comment">// 1</span>
p<span class="token punctuation">.</span>b <span class="token comment">// 37</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/study-notes/javascript/vue/双向绑定2.x版.html" class="prev">
        双向绑定2.x版
      </a></span> <span class="next"><a href="/study-notes/javascript/vue/模板编译.html">
        模板编译
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/study-notes/assets/js/app.7e1e994a.js" defer></script><script src="/study-notes/assets/js/2.0746be48.js" defer></script><script src="/study-notes/assets/js/25.b6bb2340.js" defer></script>
  </body>
</html>

<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>第二节 僵尸攻击人类 | 大花园</title>
    <meta name="generator" content="VuePress 1.9.7">
    
    <meta name="description" content="">
    
    <link rel="preload" href="/study-notes/assets/css/0.styles.12dc5de2.css" as="style"><link rel="preload" href="/study-notes/assets/js/app.7b4fbc72.js" as="script"><link rel="preload" href="/study-notes/assets/js/2.0746be48.js" as="script"><link rel="preload" href="/study-notes/assets/js/38.13e80c5a.js" as="script"><link rel="prefetch" href="/study-notes/assets/js/10.cf1260f3.js"><link rel="prefetch" href="/study-notes/assets/js/11.14d23589.js"><link rel="prefetch" href="/study-notes/assets/js/12.089741dd.js"><link rel="prefetch" href="/study-notes/assets/js/13.b87c029b.js"><link rel="prefetch" href="/study-notes/assets/js/14.cb1d9d7c.js"><link rel="prefetch" href="/study-notes/assets/js/15.8a7f170a.js"><link rel="prefetch" href="/study-notes/assets/js/16.fe9a880e.js"><link rel="prefetch" href="/study-notes/assets/js/17.19761737.js"><link rel="prefetch" href="/study-notes/assets/js/18.85b33d8f.js"><link rel="prefetch" href="/study-notes/assets/js/19.76d24227.js"><link rel="prefetch" href="/study-notes/assets/js/20.cb7e7c7a.js"><link rel="prefetch" href="/study-notes/assets/js/21.d3cc0aee.js"><link rel="prefetch" href="/study-notes/assets/js/22.4d96a993.js"><link rel="prefetch" href="/study-notes/assets/js/23.a4f13cac.js"><link rel="prefetch" href="/study-notes/assets/js/24.defe1413.js"><link rel="prefetch" href="/study-notes/assets/js/25.1e903337.js"><link rel="prefetch" href="/study-notes/assets/js/26.a704fb4e.js"><link rel="prefetch" href="/study-notes/assets/js/27.b5d0a005.js"><link rel="prefetch" href="/study-notes/assets/js/28.2d58b1c9.js"><link rel="prefetch" href="/study-notes/assets/js/29.228fb2d9.js"><link rel="prefetch" href="/study-notes/assets/js/3.504895eb.js"><link rel="prefetch" href="/study-notes/assets/js/30.254a29d3.js"><link rel="prefetch" href="/study-notes/assets/js/31.8d0833a0.js"><link rel="prefetch" href="/study-notes/assets/js/32.7f49428c.js"><link rel="prefetch" href="/study-notes/assets/js/33.f48cfc54.js"><link rel="prefetch" href="/study-notes/assets/js/34.69cecbde.js"><link rel="prefetch" href="/study-notes/assets/js/35.1e84124d.js"><link rel="prefetch" href="/study-notes/assets/js/36.c8586d3e.js"><link rel="prefetch" href="/study-notes/assets/js/37.aaf76e29.js"><link rel="prefetch" href="/study-notes/assets/js/39.7f7a5746.js"><link rel="prefetch" href="/study-notes/assets/js/4.e0b637aa.js"><link rel="prefetch" href="/study-notes/assets/js/40.c5088420.js"><link rel="prefetch" href="/study-notes/assets/js/41.df5674b3.js"><link rel="prefetch" href="/study-notes/assets/js/42.eb6ccff3.js"><link rel="prefetch" href="/study-notes/assets/js/43.cea03d38.js"><link rel="prefetch" href="/study-notes/assets/js/44.684e7ba8.js"><link rel="prefetch" href="/study-notes/assets/js/5.2e4024d9.js"><link rel="prefetch" href="/study-notes/assets/js/6.40df3bc6.js"><link rel="prefetch" href="/study-notes/assets/js/7.9613116f.js"><link rel="prefetch" href="/study-notes/assets/js/8.87a73965.js"><link rel="prefetch" href="/study-notes/assets/js/9.41a37b4d.js">
    <link rel="stylesheet" href="/study-notes/assets/css/0.styles.12dc5de2.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/study-notes/" class="home-link router-link-active"><!----> <span class="site-name">大花园</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="web2" class="dropdown-title"><span class="title">web2</span> <span class="arrow down"></span></button> <button type="button" aria-label="web2" class="mobile-dropdown-title"><span class="title">web2</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/study-notes/web2/javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/study-notes/web2/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/study-notes/web2/engineering/" class="nav-link">
  工程化
</a></li><li class="dropdown-item"><!----> <a href="/study-notes/web2/design-pattern/" class="nav-link">
  设计模式
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="web3" class="dropdown-title"><span class="title">web3</span> <span class="arrow down"></span></button> <button type="button" aria-label="web3" class="mobile-dropdown-title"><span class="title">web3</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/study-notes/web3/solidity/" class="nav-link router-link-active">
  solidity
</a></li><li class="dropdown-item"><!----> <a href="/study-notes/web3/web3js/" class="nav-link">
  web3js
</a></li></ul></div></div><div class="nav-item"><a href="/study-notes/ai/" class="nav-link">
  AI
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="web2" class="dropdown-title"><span class="title">web2</span> <span class="arrow down"></span></button> <button type="button" aria-label="web2" class="mobile-dropdown-title"><span class="title">web2</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/study-notes/web2/javascript/" class="nav-link">
  JavaScript
</a></li><li class="dropdown-item"><!----> <a href="/study-notes/web2/css/" class="nav-link">
  CSS
</a></li><li class="dropdown-item"><!----> <a href="/study-notes/web2/engineering/" class="nav-link">
  工程化
</a></li><li class="dropdown-item"><!----> <a href="/study-notes/web2/design-pattern/" class="nav-link">
  设计模式
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="web3" class="dropdown-title"><span class="title">web3</span> <span class="arrow down"></span></button> <button type="button" aria-label="web3" class="mobile-dropdown-title"><span class="title">web3</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/study-notes/web3/solidity/" class="nav-link router-link-active">
  solidity
</a></li><li class="dropdown-item"><!----> <a href="/study-notes/web3/web3js/" class="nav-link">
  web3js
</a></li></ul></div></div><div class="nav-item"><a href="/study-notes/ai/" class="nav-link">
  AI
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>cryptozombies</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/study-notes/web3/solidity/cryptozombies/introduction.html" class="sidebar-link">简介</a></li><li><a href="/study-notes/web3/solidity/cryptozombies/lesson-1.html" class="sidebar-link">第一节 搭建僵尸工厂</a></li><li><a href="/study-notes/web3/solidity/cryptozombies/lesson-2.html" aria-current="page" class="active sidebar-link">第二节 僵尸攻击人类</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/study-notes/web3/solidity/cryptozombies/lesson-2.html#笔记" class="sidebar-link">笔记</a></li><li class="sidebar-sub-header"><a href="/study-notes/web3/solidity/cryptozombies/lesson-2.html#源码" class="sidebar-link">源码</a></li></ul></li><li><a href="/study-notes/web3/solidity/cryptozombies/lesson-3.html" class="sidebar-link">第三节 高级solidity理论</a></li><li><a href="/study-notes/web3/solidity/cryptozombies/lesson-4.html" class="sidebar-link">第四节 僵尸作战系统</a></li><li><a href="/study-notes/web3/solidity/cryptozombies/lesson-5.html" class="sidebar-link">第五节 ERC721 标准和加密收藏品</a></li><li><a href="/study-notes/web3/solidity/cryptozombies/lesson-6.html" class="sidebar-link">第六节 应用前端和 Web3.js</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="第二节-僵尸攻击人类"><a href="#第二节-僵尸攻击人类" class="header-anchor">#</a> 第二节 僵尸攻击人类</h1> <h2 id="笔记"><a href="#笔记" class="header-anchor">#</a> 笔记</h2> <ol><li>合约继承：子合约能访问父合约的非私有属性之外的所有</li></ol> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">contract</span> <span class="token class-name">childContract</span> <span class="token keyword">is</span> fatherContract <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre></div><ol start="2"><li><code>mapping</code>：声明/存储数据的方法，和JavaScript的Map数据类似，是一个键值对。</li></ol> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">mapping</span> <span class="token punctuation">(</span>键 <span class="token operator">=&gt;</span> 值<span class="token punctuation">)</span> <span class="token keyword">public</span> name<span class="token punctuation">;</span>
<span class="token keyword">mapping</span> <span class="token punctuation">(</span><span class="token builtin">uint</span> <span class="token operator">=&gt;</span> <span class="token builtin">address</span><span class="token punctuation">)</span> <span class="token keyword">public</span> zombieToOwner<span class="token punctuation">;</span>
</code></pre></div><ol start="3"><li><code>msg.sender</code>：当前调用者 （ 或智能合约 ）的 address</li> <li><code>require</code>: solidity中的错误处理方式，与<code>if</code>不同的是，<code>require</code>条件未通过时会自动抛出错误。</li></ol> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">function</span> <span class="token function">createRandomZombie</span><span class="token punctuation">(</span><span class="token builtin">string</span> _name<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>ownerZombieCount<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 等同于</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ownerZombieCount<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">throw</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="5"><li><code>Storage</code>与<code>Memory</code></li></ol> <blockquote><p>Storage 变量是指永久存储在区块链中的变量。 Memory 变量则是临时的，当外部函数对某合约调用完成时，内存型变量即被移除。 你可以把它想象成存储在你电脑的硬盘或是RAM中数据的关系。</p></blockquote> <ol start="6"><li>如何调用外部合约里的方法：需要先为该合约定义合约接口，然后通过该接口去调用。</li></ol> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token comment">// 1. 有个外部合约Number</span>
<span class="token comment">// 2. 为合约定义接口</span>
<span class="token keyword">contract</span> <span class="token class-name">NumberInterface</span> <span class="token punctuation">{</span>
  <span class="token comment">// 这个是外部合约的方法，这里定义的时候不用写{}。</span>
  <span class="token keyword">function</span> <span class="token function">getNum</span><span class="token punctuation">(</span><span class="token builtin">address</span> _myAddress<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 3. 调用合约方法</span>
<span class="token comment">// 3.1 事先拿到外部合约的address</span>
<span class="token builtin">address</span> NumberInterfaceAddress <span class="token operator">=</span> <span class="token number">0xab38</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
<span class="token comment">// 3.2 声明新的合约对象</span>
NumberInterface numberContract <span class="token operator">=</span> <span class="token function">NumberInterface</span><span class="token punctuation">(</span>NumberInterfaceAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 3.3 调用</span>
numberContract<span class="token punctuation">.</span><span class="token function">getNum</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ol start="7"><li>解构赋值：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// javascript</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">3</span> <span class="token punctuation">}</span>

<span class="token comment">// solidity</span>
uint a<span class="token punctuation">;</span>
uint b<span class="token punctuation">;</span>
uint c<span class="token punctuation">;</span>
<span class="token comment">// 这样来做批量赋值:</span>
<span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">multipleReturns</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 差异点，solidity不完全是解构赋值，是按顺序赋值，如果要跳过第一个需要空写，如下：</span>
<span class="token punctuation">(</span><span class="token punctuation">,</span> <span class="token punctuation">,</span> c<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">multipleReturns</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="源码"><a href="#源码" class="header-anchor">#</a> 源码</h2> <h3 id="zombiefactory-sol"><a href="#zombiefactory-sol" class="header-anchor">#</a> zombiefactory.sol</h3> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.4.25</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">ZombieFactory</span> <span class="token punctuation">{</span>

    <span class="token keyword">event</span> <span class="token function">NewZombie</span><span class="token punctuation">(</span><span class="token builtin">uint</span> zombieId<span class="token punctuation">,</span> <span class="token builtin">string</span> name<span class="token punctuation">,</span> <span class="token builtin">uint</span> dna<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token builtin">uint</span> dnaDigits <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>
    <span class="token builtin">uint</span> dnaModulus <span class="token operator">=</span> <span class="token number">10</span> <span class="token operator">**</span> dnaDigits<span class="token punctuation">;</span>

    <span class="token keyword">struct</span> <span class="token class-name">Zombie</span> <span class="token punctuation">{</span>
        <span class="token builtin">string</span> name<span class="token punctuation">;</span>
        <span class="token builtin">uint</span> dna<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    Zombie<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">public</span> zombies<span class="token punctuation">;</span>

    <span class="token keyword">mapping</span> <span class="token punctuation">(</span><span class="token builtin">uint</span> <span class="token operator">=&gt;</span> <span class="token builtin">address</span><span class="token punctuation">)</span> <span class="token keyword">public</span> zombieToOwner<span class="token punctuation">;</span>
    <span class="token keyword">mapping</span> <span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=&gt;</span> <span class="token builtin">uint</span><span class="token punctuation">)</span> ownerZombieCount<span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">_createZombie</span><span class="token punctuation">(</span><span class="token builtin">string</span> _name<span class="token punctuation">,</span> <span class="token builtin">uint</span> _dna<span class="token punctuation">)</span> <span class="token keyword">internal</span> <span class="token punctuation">{</span>
        <span class="token builtin">uint</span> id <span class="token operator">=</span> zombies<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">Zombie</span><span class="token punctuation">(</span>_name<span class="token punctuation">,</span> _dna<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
        zombieToOwner<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
        ownerZombieCount<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">emit</span> <span class="token function">NewZombie</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> _name<span class="token punctuation">,</span> _dna<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">_generateRandomDna</span><span class="token punctuation">(</span><span class="token builtin">string</span> _str<span class="token punctuation">)</span> <span class="token keyword">private</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token builtin">uint</span> rand <span class="token operator">=</span> <span class="token builtin">uint</span><span class="token punctuation">(</span><span class="token function">keccak256</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodePacked</span><span class="token punctuation">(</span>_str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> rand <span class="token operator">%</span> dnaModulus<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">createRandomZombie</span><span class="token punctuation">(</span><span class="token builtin">string</span> _name<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>ownerZombieCount<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">uint</span> randDna <span class="token operator">=</span> <span class="token function">_generateRandomDna</span><span class="token punctuation">(</span>_name<span class="token punctuation">)</span><span class="token punctuation">;</span>
        randDna <span class="token operator">=</span> randDna <span class="token operator">-</span> randDna <span class="token operator">%</span> <span class="token number">100</span><span class="token punctuation">;</span>
        <span class="token function">_createZombie</span><span class="token punctuation">(</span>_name<span class="token punctuation">,</span> randDna<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h3 id="zombiefeeding-sol"><a href="#zombiefeeding-sol" class="header-anchor">#</a> zombiefeeding.sol</h3> <div class="language-solidity extra-class"><pre class="language-solidity"><code><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.4.25</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;./zombiefactory.sol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">contract</span> <span class="token class-name">KittyInterface</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">getKitty</span><span class="token punctuation">(</span><span class="token builtin">uint256</span> _id<span class="token punctuation">)</span> <span class="token keyword">external</span> <span class="token keyword">view</span> <span class="token keyword">returns</span> <span class="token punctuation">(</span>
    <span class="token builtin">bool</span> isGestating<span class="token punctuation">,</span>
    <span class="token builtin">bool</span> isReady<span class="token punctuation">,</span>
    <span class="token builtin">uint256</span> cooldownIndex<span class="token punctuation">,</span>
    <span class="token builtin">uint256</span> nextActionAt<span class="token punctuation">,</span>
    <span class="token builtin">uint256</span> siringWithId<span class="token punctuation">,</span>
    <span class="token builtin">uint256</span> birthTime<span class="token punctuation">,</span>
    <span class="token builtin">uint256</span> matronId<span class="token punctuation">,</span>
    <span class="token builtin">uint256</span> sireId<span class="token punctuation">,</span>
    <span class="token builtin">uint256</span> generation<span class="token punctuation">,</span>
    <span class="token builtin">uint256</span> genes
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">contract</span> <span class="token class-name">ZombieFeeding</span> <span class="token keyword">is</span> ZombieFactory <span class="token punctuation">{</span>

  <span class="token builtin">address</span> ckAddress <span class="token operator">=</span> <span class="token number">0x06012c8cf97BEaD5deAe237070F9587f8E7A266d</span><span class="token punctuation">;</span>
  KittyInterface kittyContract <span class="token operator">=</span> <span class="token function">KittyInterface</span><span class="token punctuation">(</span>ckAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">function</span> <span class="token function">feedAndMultiply</span><span class="token punctuation">(</span><span class="token builtin">uint</span> _zombieId<span class="token punctuation">,</span> <span class="token builtin">uint</span> _targetDna<span class="token punctuation">,</span> <span class="token builtin">string</span> _species<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> zombieToOwner<span class="token punctuation">[</span>_zombieId<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Zombie <span class="token keyword">storage</span> myZombie <span class="token operator">=</span> zombies<span class="token punctuation">[</span>_zombieId<span class="token punctuation">]</span><span class="token punctuation">;</span>
    _targetDna <span class="token operator">=</span> _targetDna <span class="token operator">%</span> dnaModulus<span class="token punctuation">;</span>
    <span class="token builtin">uint</span> newDna <span class="token operator">=</span> <span class="token punctuation">(</span>myZombie<span class="token punctuation">.</span>dna <span class="token operator">+</span> _targetDna<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">keccak256</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodePacked</span><span class="token punctuation">(</span>_species<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">keccak256</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodePacked</span><span class="token punctuation">(</span><span class="token string">&quot;kitty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      newDna <span class="token operator">=</span> newDna <span class="token operator">-</span> newDna <span class="token operator">%</span> <span class="token number">100</span> <span class="token operator">+</span> <span class="token number">99</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">_createZombie</span><span class="token punctuation">(</span><span class="token string">&quot;NoName&quot;</span><span class="token punctuation">,</span> newDna<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">feedOnKitty</span><span class="token punctuation">(</span><span class="token builtin">uint</span> _zombieId<span class="token punctuation">,</span> <span class="token builtin">uint</span> _kittyId<span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
    <span class="token builtin">uint</span> kittyDna<span class="token punctuation">;</span>
    <span class="token punctuation">(</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span><span class="token punctuation">,</span>kittyDna<span class="token punctuation">)</span> <span class="token operator">=</span> kittyContract<span class="token punctuation">.</span><span class="token function">getKitty</span><span class="token punctuation">(</span>_kittyId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">feedAndMultiply</span><span class="token punctuation">(</span>_zombieId<span class="token punctuation">,</span> kittyDna<span class="token punctuation">,</span> <span class="token string">&quot;kitty&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/study-notes/web3/solidity/cryptozombies/lesson-1.html" class="prev">
        第一节 搭建僵尸工厂
      </a></span> <span class="next"><a href="/study-notes/web3/solidity/cryptozombies/lesson-3.html">
        第三节 高级solidity理论
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/study-notes/assets/js/app.7b4fbc72.js" defer></script><script src="/study-notes/assets/js/2.0746be48.js" defer></script><script src="/study-notes/assets/js/38.13e80c5a.js" defer></script>
  </body>
</html>
